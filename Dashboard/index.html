<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../dist/output.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />

    <link
      href="https://fonts.googleapis.com/css2?family=Baloo+Paaji+2:wght@400..800&family=Handlee&family=Josefin+Sans:ital,wght@0,100..700;1,100..700&family=Julius+Sans+One&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Newsreader:ital,opsz,wght@0,6..72,200..800;1,6..72,200..800&family=Parkinsans:wght@300..800&family=Quicksand:wght@700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="index.css" />
    <title>Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <main class="w-[80%] mx-auto my-2">
      <div class="max-w-3xl mx-auto">
        
        <!-- Flex Container for Greeting and Log Out Button -->
        <div class="flex justify-center items-center mb-8 mt-10">
          <div class="flex items-center">
            <!-- FinAi Branding -->
            <div class="flex items-center mr-6 absolute left-40">
              <span class="text-3xl font-bold text-green-700">FinAi</span>
            </div>
            <h1 class="greetings text-6xl select-none justify-center">
              Good Morning, User
            </h1>
          </div>
          <button
            id="backButton"
            type="button"
            class="bg-[#426B1F] px-4 py-2 rounded-full text-white hover:bg-green-700 transition duration-200 flex items-center justify-center absolute right-40"
            aria-label="Log Out"
          >
            <i class="bi bi-box-arrow-right text-xl"></i>
          </button>
        </div>
        
        <hr width="100%" class="mx-auto mb-8" />
        
        <!-- ... rest of your content ... -->

      </div>
      <div class="data flex rounded-3xl my-5 box-border gap-4">
        <div
          class="Left min-h-full grow-[0.7] rounded-3xl flex flex-col box-border justify-between gap-4"
        >
          <div
            class="h-80 box-border bg-[#FAFAF5] rounded-3xl border-[#E6E6E6] border-2 flex overflow-hidden"
          >
            <div
              id="loanEligibility"
              class="inline-flex justify-center items-center Left w-[30%] h-full bg-[#E6E6E6] rounded-r-none text-center z-0"
            >
              <i>
                <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" class="bi bi-currency-rupee" viewBox="0 0 16 16">
                  <path d="M4 3.06h2.726c1.22 0 2.12.575 2.325 1.724H4v1.051h5.051C8.855 7.001 8 7.558 6.788 7.558H4v1.317L8.437 14h2.11L6.095 8.884h.855c2.316-.018 3.465-1.476 3.688-3.049H12V4.784h-1.345c-.08-.778-.357-1.335-.793-1.732H12V2H4z"/>
                </svg>
              </i>
            </div>
            <div
              class="flex flex-1 h-full Right justify-center items-center relative"
            >
              <!-- Loan eligibilty checker -->
              <div class="text-2xl text-black z-10 justify-items-center">
                <!-- Section Title -->
                Check Your Loan Eligibilty!
              </div>
              <button
                onclick="window.location.href='LoanEligibility/checkLoanEligibility.html'"
                class="bg-[#426B1F] px-4 py-2 rounded-md text-white absolute bottom-4 right-4 hover:bg-green-700 transition duration-200"
              >
                Check Now
              </button>
            </div>
          </div>

          <div
            class="h-80 box-border bg-[#FAFAF5] rounded-3xl border-[#E6E6E6] border-2 flex overflow-hidden"
          >
            <div
              class="flex justify-center items-center Left w-[30%] h-full bg-[#E6E6E6] rounded-3xl rounded-r-none text-center"
            >
              <!-- Currency Converter -->
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="50"
                height="50"
                fill="currentColor"
                class="bi bi-currency-exchange"
                viewBox="0 0 16 16"
              >
                <path
                  d="M0 0h1v15h15v1H0zm10 3.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V4.9l-3.613 4.417a.5.5 0 0 1-.74.037L7.06 6.767l-3.656 5.027a.5.5 0 0 1-.808-.588l4-5.5a.5.5 0 0 1 .758-.06l2.609 2.61L13.445 4H10.5a.5.5 0 0 1-.5-.5"
                />
              </svg>
            </div>
            <div
              class="flex flex-1 h-full Right justify-center items-center relative"
            >
              <div class="text-2xl">Currency Converter</div>
              <button
                onclick="window.location.href='CurrencyConverter/index.html'"
                class="bg-[#426B1F] px-4 py-2 rounded-md text-white absolute bottom-4 right-4 hover:bg-green-700 transition duration-200"
              >
                Convert Now
              </button>
            </div>
          </div>
        </div>
        <div
          class="Right bg-[#FAFAF5] grow-[0.3] rounded-3xl border-[#E6E6E6] border-2 flex flex-col box-border overflow-hidden"
        >
          <div
            class="Top grow-[0.2] bg-[#E6E6E6] rounded-b-none box-border flex justify-center items-center"
          >
            <div class="chartContainer bg-[#E6E6E6] p-4 rounded-md">
              <!-- Chart Container -->
              <canvas id="myChart" width="800" height="200"></canvas>
            </div>
          </div>
          <div class="Bottom grow-[0.9] bg-[#FAFAF5] p-4">
            <div class="text-2xl mb-4">Expense Analyser</div>
            <div class="flex justify-between items-center mb-4">
              <div class="text-xl">
                Today's Total: â‚¹<span id="dailyTotal2">0.00</span>
              </div>
              <button
                onclick="window.location.href='expenses.html'"
                class="bg-[#426B1F] px-4 py-2 rounded-md text-white w-full hover:bg-green-700 transition duration-200"
              >
                View Details
              </button>
            </div>
            <form id="expenseForm" class="flex flex-col gap-4 items-center">
              <input
                type="number"
                id="amount"
                placeholder="Amount"
                class="border rounded px-4 py-2 w-full"
                required
              />
              <input
                type="text"
                id="description"
                placeholder="Description"
                class="border rounded px-4 py-2 w-full"
                required
              />
              <!-- New Date Picker Input -->
              <div class="w-full">
                <label for="expenseDate" class="block text-gray-700">Date</label>
                <input
                  type="date"
                  id="expenseDate"
                  class="mt-1 w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                  required
                />
              </div>
              <button
                type="submit"
                class="bg-[#426B1F] px-4 py-2 rounded-md text-white w-full hover:bg-green-700 transition duration-200"
              >
                Add Expense
              </button>
            </form>
            <div id="expenseList" class="border-b py-2 flex justify-between items-center">
              <!-- Expense items will be dynamically inserted here -->
            </div>

    <script src="dashboard.js"></script>
    <script src="chart.js"></script>
    <script>
      async function calculateDailyTotal() {
        const dailyTotalElement = document.getElementById('dailyTotal2');
        const username = localStorage.getItem('currentUsername');

        if (!username) {
          console.error('Username not found in localStorage.');
          dailyTotalElement.textContent = '0.00';
          return;
        }

        try {
          const response = await fetch(`http://localhost:8000/expenses/${username}`);
          const data = await response.json();

          if (data.expenses) {
            const today = new Date().toLocaleDateString("en-CA");
            const todaysExpenses = data.expenses.filter(exp => exp.date.startsWith(today));
            const total = todaysExpenses.reduce((sum, exp) => sum + exp.amount, 0);
            dailyTotalElement.textContent = total.toFixed(2);
          } else {
            console.error('No expenses data found.');
            dailyTotalElement.textContent = '0.00';
          }
        } catch (error) {
          console.error('Error fetching expenses:', error);
          dailyTotalElement.textContent = '0.00';
        }
      }

      // Call the function when DOM is loaded
      document.addEventListener('DOMContentLoaded', calculateDailyTotal);
    </script>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const setTodayDate = (inputId) => {
          const dateInput = document.getElementById(inputId);
          if (dateInput) {
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0'); // Months start at 0!
            const dd = String(today.getDate()).padStart(2, '0');
            const formattedToday = `${yyyy}-${mm}-${dd}`;
            dateInput.value = formattedToday;
          }
        };

        // Set default dates for specific inputs
        setTodayDate('expenseDate'); // For Dashboard/index.html
        setTodayDate('applicationDate'); // For checkLoanEligibility.html
        // Add more IDs as needed
      });
    </script>
  </body>
</html>
